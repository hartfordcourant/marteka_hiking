(function(){function e(){}function n(e,t){var n=e.length;while(n--){if(e[n].listener===t){return n}}return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var t=e.prototype;t.getListeners=function(t){var n=this._getEvents();var r;var i;if(typeof t==="object"){r={};for(i in n){if(n.hasOwnProperty(i)&&t.test(i)){r[i]=n[i]}}}else{r=n[t]||(n[t]=[])}return r};t.flattenListeners=function(t){var n=[];var r;for(r=0;r<t.length;r+=1){n.push(t[r].listener)}return n};t.getListenersAsObject=function(t){var n=this.getListeners(t);var r;if(n instanceof Array){r={};r[t]=n}return r||n};t.addListener=function(t,r){var i=this.getListenersAsObject(t);var s=typeof r==="object";var o;for(o in i){if(i.hasOwnProperty(o)&&n(i[o],r)===-1){i[o].push(s?r:{listener:r,once:false})}}return this};t.on=r("addListener");t.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:true})};t.once=r("addOnceListener");t.defineEvent=function(t){this.getListeners(t);return this};t.defineEvents=function(t){for(var n=0;n<t.length;n+=1){this.defineEvent(t[n])}return this};t.removeListener=function(t,r){var i=this.getListenersAsObject(t);var s;var o;for(o in i){if(i.hasOwnProperty(o)){s=n(i[o],r);if(s!==-1){i[o].splice(s,1)}}}return this};t.off=r("removeListener");t.addListeners=function(t,n){return this.manipulateListeners(false,t,n)};t.removeListeners=function(t,n){return this.manipulateListeners(true,t,n)};t.manipulateListeners=function(t,n,r){var i;var s;var o=t?this.removeListener:this.addListener;var u=t?this.removeListeners:this.addListeners;if(typeof n==="object"&&!(n instanceof RegExp)){for(i in n){if(n.hasOwnProperty(i)&&(s=n[i])){if(typeof s==="function"){o.call(this,i,s)}else{u.call(this,i,s)}}}}else{i=r.length;while(i--){o.call(this,n,r[i])}}return this};t.removeEvent=function(t){var n=typeof t;var r=this._getEvents();var i;if(n==="string"){delete r[t]}else if(n==="object"){for(i in r){if(r.hasOwnProperty(i)&&t.test(i)){delete r[i]}}}else{delete this._events}return this};t.removeAllListeners=r("removeEvent");t.emitEvent=function(t,n){var r=this.getListenersAsObject(t);var i;var s;var o;var u;for(o in r){if(r.hasOwnProperty(o)){s=r[o].length;while(s--){i=r[o][s];if(i.once===true){this.removeListener(t,i.listener)}u=i.listener.apply(this,n||[]);if(u===this._getOnceReturnValue()){this.removeListener(t,i.listener)}}}}return this};t.trigger=r("emitEvent");t.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)};t.setOnceReturnValue=function(t){this._onceReturnValue=t;return this};t._getOnceReturnValue=function(){if(this.hasOwnProperty("_onceReturnValue")){return this._onceReturnValue}else{return true}};t._getEvents=function(){return this._events||(this._events={})};if(typeof define==="function"&&define.amd){define("eventEmitter/EventEmitter",[],function(){return e})}else if(typeof module==="object"&&module.exports){module.exports=e}else{this.EventEmitter=e}}).call(this);(function(e){var t=document.documentElement;var n=function(){};if(t.addEventListener){n=function(e,t,n){e.addEventListener(t,n,false)}}else if(t.attachEvent){n=function(t,n,r){t[n+r]=r.handleEvent?function(){var t=e.event;t.target=t.target||t.srcElement;r.handleEvent.call(r,t)}:function(){var n=e.event;n.target=n.target||n.srcElement;r.call(t,n)};t.attachEvent("on"+n,t[n+r])}}var r=function(){};if(t.removeEventListener){r=function(e,t,n){e.removeEventListener(t,n,false)}}else if(t.detachEvent){r=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(r){e[t+n]=undefined}}}var i={bind:n,unbind:r};if(typeof define==="function"&&define.amd){define("eventie/eventie",i)}else{e.eventie=i}})(this);(function(e){function i(e,t){for(var n in t){e[n]=t[n]}return e}function o(e){return s.call(e)==="[object Array]"}function u(e){var t=[];if(o(e)){t=e}else if(typeof e.length==="number"){for(var n=0,r=e.length;n<r;n++){t.push(e[n])}}else{t.push(e)}return t}function a(e,n){function s(e,n,r){if(!(this instanceof s)){return new s(e,n)}if(typeof e==="string"){e=document.querySelectorAll(e)}this.elements=u(e);this.options=i({},this.options);if(typeof n==="function"){r=n}else{i(this.options,n)}if(r){this.on("always",r)}this.getImages();if(t){this.jqDeferred=new t.Deferred}var o=this;setTimeout(function(){o.check()})}function a(e){this.img=e}s.prototype=new e;s.prototype.options={};s.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;e<t;e++){var n=this.elements[e];if(n.nodeName==="IMG"){this.addImage(n)}var r=n.querySelectorAll("img");for(var i=0,s=r.length;i<s;i++){var o=r[i];this.addImage(o)}}};s.prototype.addImage=function(e){var t=new a(e);this.images.push(t)};s.prototype.check=function(){function i(i,s){if(e.options.debug&&r){}e.progress(i);t++;if(t===n){e.complete()}return true}var e=this;var t=0;var n=this.images.length;this.hasAnyBroken=false;if(!n){this.complete();return}for(var s=0;s<n;s++){var o=this.images[s];o.on("confirm",i);o.check()}};s.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e);if(t.jqDeferred){t.jqDeferred.notify(t,e)}})};s.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=true;var t=this;setTimeout(function(){t.emit(e,t);t.emit("always",t);if(t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})};if(t){t.fn.imagesLoaded=function(e,n){var r=new s(this,e,n);return r.jqDeferred.promise(t(this))}}var o={};a.prototype=new e;a.prototype.check=function(){var e=o[this.img.src];if(e){this.useCached(e);return}o[this.img.src]=this;if(this.img.complete&&this.img.naturalWidth!==undefined){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}var t=this.proxyImage=new Image;n.bind(t,"load",this);n.bind(t,"error",this);t.src=this.img.src};a.prototype.useCached=function(e){if(e.isConfirmed){this.confirm(e.isLoaded,"cached was confirmed")}else{var t=this;e.on("confirm",function(e){t.confirm(e.isLoaded,"cache emitted confirmed");return true})}};a.prototype.confirm=function(e,t){this.isConfirmed=true;this.isLoaded=e;this.emit("confirm",this,t)};a.prototype.handleEvent=function(e){var t="on"+e.type;if(this[t]){this[t](e)}};a.prototype.onload=function(){this.confirm(true,"onload");this.unbindProxyEvents()};a.prototype.onerror=function(){this.confirm(false,"onerror");this.unbindProxyEvents()};a.prototype.unbindProxyEvents=function(){n.unbind(this.proxyImage,"load",this);n.unbind(this.proxyImage,"error",this)};return s}var t=e.jQuery;var n=e.console;var r=typeof n!=="undefined";var s=Object.prototype.toString;if(typeof define==="function"&&define.amd){define(["eventEmitter/EventEmitter","eventie/eventie"],a)}else{e.imagesLoaded=a(e.EventEmitter,e.eventie)}})(window)